{"version":3,"file":"taxi.modern.js","sources":["../src/helpers.js","../src/Transition.js","../src/Renderer.js","../src/RouteStore.js","../src/Core.js"],"sourcesContent":["const parser = new DOMParser()\n\n/**\n * Parse a HTML string into a proper Document.\n * @param {string|Document} html\n * @return {Document|*}\n */\nexport function parseDom(html) {\n\treturn typeof html === 'string' ? parser.parseFromString(html, 'text/html') : html\n}\n\n/**\n * Extract details from a given URL string. Assumed to be on the current TLD.\n * @param {string} url\n * @return {{raw: string, href: string, host: string, hasHash: boolean, pathname: string}}\n */\nexport function processUrl(url) {\n\tconst details = new URL(url, window.location.origin)\n\tlet normalized = null\n\n\tif (details.hash.length) {\n\t\tnormalized = url.replace(details.hash, '')\n\t}\n\n\treturn {\n\t\thasHash: details.hash.length > 0,\n\t\tpathname: details.pathname,\n\t\thost: details.host,\n\t\traw: url,\n\t\thref: normalized || details.href\n\t}\n}\n\n/**\n * Reloads a provided script/stylesheet by replacing with itself.\n * @param {HTMLElement|HTMLScriptElement} node\n */\nexport function reloadScript(node) {\n\tnode.parentNode.replaceChild(duplicateScript(node), node)\n}\n\n/**\n * Loads a provided script/stylesheet by appending a clone to the current document.\n * @param {HTMLElement} node\n */\nexport function appendScript(node) {\n\tif (node.parentNode.tagName === 'HEAD') {\n\t\tdocument.head.appendChild(duplicateScript(node))\n\t} else {\n\t\tdocument.body.appendChild(duplicateScript(node))\n\t}\n}\n\n/**\n * Creates a clone of a given HTMLElement\n * @param {HTMLElement} node\n * @return {HTMLElement}\n */\nexport function duplicateScript(node) {\n\tconst replacement = document.createElement('SCRIPT')\n\n\t// Loop Over Attributes\n\tfor (let k = 0; k < node.attributes.length; k++) {\n\t\t// Get Attribute\n\t\tconst attr = node.attributes[k]\n\n\t\t// Set Attribute\n\t\treplacement.setAttribute(attr.nodeName, attr.nodeValue)\n\t}\n\n\t// Inline Script\n\tif (node.innerHTML) {\n\t\treplacement.innerHTML = node.innerHTML\n\t}\n\n\treturn replacement\n}\n","export default class Transition {\n\t/**\n\t * @param {{wrapper: HTMLElement}} props\n\t */\n\tconstructor({ wrapper }) {\n\t\tthis.wrapper = wrapper\n\t}\n\n\t/**\n\t * @param {{ from: HTMLElement|Element, trigger: string|HTMLElement|false }} props\n\t * @return {Promise<void>}\n\t */\n\tleave(props) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onLeave({ ...props, done: resolve })\n\t\t})\n\t}\n\n\t/**\n\t * @param {{ to: HTMLElement|Element, trigger: string|HTMLElement|false }} props\n\t * @return {Promise<void>}\n\t */\n\tenter(props) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onEnter({ ...props, done: resolve })\n\t\t})\n\t}\n\n\t/**\n\t * Handle the transition leaving the previous page.\n\t * @param {{from: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\n\t */\n\tonLeave({ from, trigger, done }) {\n\t\tdone()\n\t}\n\n\t/**\n\t * Handle the transition entering the next page.\n\t * @param {{to: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\n\t */\n\tonEnter({ to, trigger, done }) {\n\t\tdone()\n\t}\n}\n","import Transition from \"./Transition\"\n\nexport default class Renderer {\n\t/**\n\t * @param {{content: HTMLElement|Element, page: Document|Node, title: string, wrapper: Element}} props\n\t */\n\tconstructor({ content, page, title, wrapper }) {\n\t\tthis._contentString = content.outerHTML\n\t\tthis._DOM = null\n\t\tthis.page = page\n\t\tthis.title = title\n\t\tthis.wrapper = wrapper\n\t\tthis.content = this.wrapper.lastElementChild\n\t}\n\n\tonEnter() {\n\n\t}\n\n\tonEnterCompleted() {\n\n\t}\n\n\tonLeave() {\n\n\t}\n\n\tonLeaveCompleted() {\n\n\t}\n\n\tinitialLoad() {\n\t\tthis.onEnter()\n\t\tthis.onEnterCompleted()\n\t}\n\n\tupdate() {\n\t\tdocument.title = this.title\n\t\tthis.wrapper.appendChild(this._DOM.firstElementChild)\n\t\tthis.content = this.wrapper.lastElementChild\n\t\tthis._DOM = null\n\t}\n\n\tcreateDom() {\n\t\tif (!this._DOM) {\n\t\t\tthis._DOM = document.createElement('div')\n\t\t\tthis._DOM.innerHTML = this._contentString\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.wrapper.firstElementChild.remove()\n\t}\n\n\t/**\n\t * Called when transitioning into the current page.\n\t * @param {Transition} transition\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<null>}\n\t */\n\tenter(transition, trigger) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onEnter()\n\n\t\t\ttransition.enter({ trigger, to: this.content })\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.onEnterCompleted()\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Called when transitioning away from the current page.\n\t * @param {Transition} transition\n\t * @param {string|HTMLElement|false} trigger\n\t * @param {boolean} removeOldContent\n\t * @return {Promise<null>}\n\t */\n\tleave(transition, trigger, removeOldContent) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onLeave()\n\n\t\t\ttransition.leave({ trigger, from: this.content })\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (removeOldContent) {\n\t\t\t\t\t\tthis.remove()\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.onLeaveCompleted()\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n}\n","export default class RouteStore {\n\t/**\n\t * @type {Map<string, Map<string, string>>}\n\t */\n\tdata = new Map()\n\n\t/**\n\t * @type {Map<string, RegExp>}\n\t */\n\tregexCache = new Map()\n\n\t/**\n\t *\n\t * @param {string} fromPattern\n\t * @param {string} toPattern\n\t * @param {string} transition\n\t */\n\tadd(fromPattern, toPattern, transition) {\n\t\tif (!this.data.has(fromPattern)) {\n\t\t\tthis.data.set(fromPattern, new Map())\n\t\t\tthis.regexCache.set(fromPattern, new RegExp(`^${fromPattern}$`))\n\t\t}\n\n\t\tthis.data.get(fromPattern).set(toPattern, transition)\n\t\tthis.regexCache.set(toPattern, new RegExp(`^${toPattern}$`))\n\t}\n\n\t/**\n\t *\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} currentUrl\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} nextUrl\n\t * @return {string|null}\n\t */\n\tfindMatch(currentUrl, nextUrl) {\n\t\t// Loop through all from patterns\n\t\tfor (const [fromPattern, potentialMatches] of this.data) {\n\t\t\t// If we have a match\n\t\t\tif (currentUrl.pathname.match(this.regexCache.get(fromPattern))) {\n\t\t\t\t// loop through all associated to patterns\n\t\t\t\tfor (const [toPattern, transition] of potentialMatches) {\n\t\t\t\t\t// If we find a match, return it\n\t\t\t\t\tif (nextUrl.pathname.match(this.regexCache.get(toPattern))) {\n\t\t\t\t\t\treturn transition\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\treturn null\n\t}\n}\n","import E from '@unseenco/e'\nimport { appendScript, parseDom, processUrl, reloadScript } from './helpers'\nimport Transition from './Transition'\nimport Renderer from './Renderer'\nimport RouteStore from './RouteStore'\n\nconst IN_PROGRESS = 'A transition is currently in progress'\n\n/**\n * @typedef CacheEntry\n * @type {object}\n * @property {typeof Renderer|Renderer} renderer\n * @property {Document|Node} page\n * @property {array} scripts\n * @property {HTMLLinkElement[]} styles\n * @property {string} finalUrl\n * @property {boolean} skipCache\n * @property {string} title\n * @property {HTMLElement|Element} content\n */\n\nexport default class Core {\n\tisTransitioning = false\n\n\t/**\n\t * @type {CacheEntry|null}\n\t */\n\tcurrentCacheEntry = null\n\n\t/**\n\t * @type {Map<string, CacheEntry>}\n\t */\n\tcache = new Map()\n\n\t/**\n\t * @private\n\t * @type {Map<string, Promise>}\n\t */\n\tactivePromises = new Map()\n\n\t/**\n\t * @param {{\n\t * \t\tlinks?: string,\n\t * \t\tremoveOldContent?: boolean,\n\t * \t\tallowInterruption?: boolean,\n\t * \t\tbypassCache?: boolean,\n\t * \t\tenablePrefetch?: boolean,\n\t * \t\trenderers?: Object.<string, typeof Renderer>,\n\t * \t\ttransitions?: Object.<string, typeof Transition>,\n\t * \t\treloadJsFilter?: boolean|function(HTMLElement): boolean,\n\t * \t\treloadCssFilter?: boolean|function(HTMLLinkElement): boolean\n\t * }} parameters\n\t */\n\tconstructor(parameters = {}) {\n\t\tconst {\n\t\t\tlinks = 'a:not([target]):not([href^=\\\\#]):not([data-taxi-ignore])',\n\t\t\tremoveOldContent = true,\n\t\t\tallowInterruption = false,\n\t\t\tbypassCache = false,\n\t\t\tenablePrefetch = true,\n\t\t\trenderers = {\n\t\t\t\tdefault: Renderer\n\t\t\t},\n\t\t\ttransitions = {\n\t\t\t\tdefault: Transition\n\t\t\t},\n\t\t\treloadJsFilter = (element) => element.dataset.taxiReload !== undefined,\n\t\t\treloadCssFilter = (element) => true //element.dataset.taxiReload !== undefined\n\t\t} = parameters\n\n\t\tthis.renderers = renderers\n\t\tthis.transitions = transitions\n\t\tthis.defaultRenderer = this.renderers.default || Renderer\n\t\tthis.defaultTransition = this.transitions.default || Transition\n\t\tthis.wrapper = document.querySelector('[data-taxi]')\n\t\tthis.reloadJsFilter = reloadJsFilter\n\t\tthis.reloadCssFilter = reloadCssFilter\n\t\tthis.removeOldContent = removeOldContent\n\t\tthis.allowInterruption = allowInterruption\n\t\tthis.bypassCache = bypassCache\n\t\tthis.enablePrefetch = enablePrefetch\n\t\tthis.cache = new Map()\n\t\tthis.isPopping = false\n\n\t\t// Add delegated link events\n\t\tthis.attachEvents(links)\n\n\t\tthis.currentLocation = processUrl(window.location.href)\n\n\t\t// as this is the initial page load, prime this page into the cache\n\t\tthis.cache.set(this.currentLocation.href, this.createCacheEntry(document.cloneNode(true), window.location.href))\n\n\t\t// fire the current Renderer enter methods\n\t\tthis.currentCacheEntry = this.cache.get(this.currentLocation.href)\n\t\tthis.currentCacheEntry.renderer.initialLoad()\n\t}\n\n\t/**\n\t * @param {string} renderer\n\t */\n\tsetDefaultRenderer(renderer) {\n\t\tthis.defaultRenderer = this.renderers[renderer]\n\t}\n\n\t/**\n\t * @param {string} transition\n\t */\n\tsetDefaultTransition(transition) {\n\t\tthis.defaultTransition = this.transitions[transition]\n\t}\n\n\t/**\n\t * Registers a route into the RouteStore\n\t *\n\t * @param {string} fromPattern\n\t * @param {string} toPattern\n\t * @param {string} transition\n\t */\n\taddRoute(fromPattern, toPattern, transition) {\n\t\tif (!this.router) {\n\t\t\tthis.router = new RouteStore()\n\t\t}\n\n\t\tthis.router.add(fromPattern, toPattern, transition)\n\t}\n\n\t/**\n\t * Prime the cache for a given URL\n\t *\n\t * @param {string} url\n\t * @param {boolean} [preloadAssets]\n\t * @return {Promise}\n\t */\n\tpreload(url, preloadAssets = false) {\n\t\t// convert relative URLs to absolute\n\t\turl = processUrl(url).href\n\n\t\tif (!this.cache.has(url)) {\n\t\t\treturn this.fetch(url, false)\n\t\t\t\t.then(async (response) => {\n\t\t\t\t\tthis.cache.set(url, this.createCacheEntry(response.html, response.url))\n\n\t\t\t\t\tif (preloadAssets) {\n\t\t\t\t\t\tthis.cache.get(url).renderer.createDom()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t}\n\n\t\treturn Promise.resolve()\n\t}\n\n\t/**\n\t * Updates the HTML cache for a given URL.\n\t * If no URL is passed, then cache for the current page is updated.\n\t * Useful when adding/removing content via AJAX such as a search page or infinite loader.\n\t *\n\t * @param {string} [url]\n\t */\n\tupdateCache(url) {\n\t\tconst key = processUrl(url || window.location.href).href\n\n\t\tif (this.cache.has(key)) {\n\t\t\tthis.cache.delete(key)\n\t\t}\n\n\t\tthis.cache.set(key, this.createCacheEntry(document.cloneNode(true), key))\n\t}\n\n\t/**\n\t * Clears the cache for a given URL.\n\t * If no URL is passed, then cache for the current page is cleared.\n\t *\n\t * @param {string} [url]\n\t */\n\tclearCache(url) {\n\t\tconst key = processUrl(url || window.location.href).href\n\n\t\tif (this.cache.has(key)) {\n\t\t\tthis.cache.delete(key)\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} url\n\t * @param {string|false} [transition]\n\t * @param {string|false|HTMLElement} [trigger]\n\t * @return {Promise<void|Error>}\n\t */\n\tnavigateTo(url, transition = false, trigger = false) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// Don't allow multiple navigations to occur at once\n\t\t\tif (!this.allowInterruption && this.isTransitioning) {\n\t\t\t\treject(new Error(IN_PROGRESS))\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tthis.isTransitioning = true\n\t\t\tthis.isPopping = true\n\t\t\tthis.targetLocation = processUrl(url)\n\t\t\tthis.popTarget = window.location.href\n\n\t\t\tconst TransitionClass = new (this.chooseTransition(transition))({ wrapper: this.wrapper })\n\n\t\t\tlet navigationPromise\n\n\t\t\tif (this.bypassCache || !this.cache.has(this.targetLocation.href) || this.cache.get(this.targetLocation.href).skipCache) {\n\t\t\t\tconst fetched = this.fetch(this.targetLocation.href)\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.cache.set(this.targetLocation.href, this.createCacheEntry(response.html, response.url))\n\t\t\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\n\t\t\t\t\t})\n\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\n\t\t\t\t\t.then(async () => {\n\t\t\t\t\t\treturn fetched.then(async () => {\n\t\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\n\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\n\t\t\t\t\t.then(async () => {\n\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\n\t\t\t\t\t})\n\t\t\t}\n\n\t\t\tnavigationPromise.then(() => {\n\t\t\t\tresolve()\n\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Add an event listener.\n\t * @param {string} event\n\t * @param {any} callback\n\t */\n\ton(event, callback) {\n\t\tE.on(event, callback)\n\t}\n\n\t/**\n\t * Remove an event listener.\n\t * @param {string} event\n\t * @param {any} [callback]\n\t */\n\toff(event, callback) {\n\t\tE.off(event, callback)\n\t}\n\n\t/**\n\t * @private\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} url\n\t * @param {Transition} TransitionClass\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<void>}\n\t */\n\tbeforeFetch(url, TransitionClass, trigger) {\n\t\tE.emit('NAVIGATE_OUT', {\n\t\t\tfrom: this.currentCacheEntry,\n\t\t\ttrigger\n\t\t})\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.currentCacheEntry.renderer.leave(TransitionClass, trigger, this.removeOldContent)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (trigger !== 'popstate') {\n\t\t\t\t\t\tconsole.log('ass',url)\n\t\t\t\t\t\twindow.history.pushState({}, '', url.raw)\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * @private\n\t * @param {{ raw: string, href: string, host: string, hasHash: boolean, pathname: string }} url\n\t * @param {Transition} TransitionClass\n\t * @param {CacheEntry} entry\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<void>}\n\t */\n\tafterFetch(url, TransitionClass, entry, trigger) {\n\t\tthis.currentLocation = url\n\t\tthis.popTarget = this.currentLocation.href\n\n\t\treturn new Promise((resolve) => {\n\t\t\tentry.renderer.update()\n\n\t\t\tE.emit('NAVIGATE_IN', {\n\t\t\t\tfrom: this.currentCacheEntry,\n\t\t\t\tto: entry,\n\t\t\t\ttrigger\n\t\t\t})\n\n\t\t\tif (this.reloadJsFilter) {\n\t\t\t\tthis.loadScripts(entry.scripts)\n\t\t\t}\n\n\t\t\tif (this.reloadCssFilter) {\n\t\t\t\tthis.loadStyles(entry.styles)\n\t\t\t}\n\n\t\t\t// If the fetched url had a redirect chain, then replace the history to reflect the final resolved URL\n\t\t\tif (trigger !== 'popstate' && url.href !== entry.finalUrl) {\n\t\t\t\twindow.history.replaceState({}, '', entry.finalUrl)\n\t\t\t}\n\n\t\t\tentry.renderer.enter(TransitionClass, trigger)\n\t\t\t\t.then(() => {\n\t\t\t\t\tE.emit('NAVIGATE_END', {\n\t\t\t\t\t\tfrom: this.currentCacheEntry,\n\t\t\t\t\t\tto: entry,\n\t\t\t\t\t\ttrigger\n\t\t\t\t\t})\n\n\t\t\t\t\tthis.currentCacheEntry = entry\n\t\t\t\t\tthis.isTransitioning = false\n\t\t\t\t\tthis.isPopping = false\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Load up scripts from the target page if needed\n\t *\n\t * @param {HTMLElement[]} cachedScripts\n\t */\n\tloadScripts(cachedScripts) {\n\t\tconst newScripts = [...cachedScripts]\n\t\tconst currentScripts = Array.from(document.querySelectorAll('script')).filter(this.reloadJsFilter)\n\n\t\t// loop through all new scripts\n\t\tfor (let i = 0; i < currentScripts.length; i++) {\n\t\t\tfor (let n = 0; n < newScripts.length; n++) {\n\t\t\t\tif (currentScripts[i].outerHTML === newScripts[n].outerHTML) {\n\t\t\t\t\treloadScript(currentScripts[i])\n\t\t\t\t\tnewScripts.splice(n, 1)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const script of newScripts) {\n\t\t\tappendScript(script)\n\t\t}\n\t}\n\n\t/**\n\t * Load up styles from the target page if needed\n\t *\n\t * @param {HTMLLinkElement[]} cachedStyles\n\t */\n\tloadStyles(cachedStyles) {\n\t\tconst currentStyles = Array.from(document.querySelectorAll('link[rel=\"stylesheet\"]')).filter(this.reloadCssFilter)\n\n\t\tcachedStyles.forEach(el => {\n\t\t\tif (el.href && !currentStyles.find((link) => link.href === el.href)) {\n\t\t\t\tdocument.body.append(el)\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * @private\n\t * @param {string} links\n\t */\n\tattachEvents(links) {\n\t\tE.delegate('click', links, this.onClick)\n\t\tE.on('popstate', window, this.onPopstate)\n\n\t\tif (this.enablePrefetch) {\n\t\t\tE.delegate('mouseenter focus', links, this.onPrefetch)\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {MouseEvent} e\n\t */\n\tonClick = (e) => {\n\t\tif (!(e.metaKey || e.ctrlKey)) {\n\t\t\tconst target = processUrl(e.currentTarget.href)\n\t\t\tthis.currentLocation = processUrl(window.location.href)\n\n\t\t\tif (this.currentLocation.host !== target.host) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// the target is a new URL, or is removing the hash from the current URL\n\t\t\tif (this.currentLocation.href !== target.href || (this.currentLocation.hasHash && !target.hasHash)) {\n\t\t\t\te.preventDefault()\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\tthis.navigateTo(target.raw, e.currentTarget.dataset.transition || false, e.currentTarget).catch(err => console.warn(err))\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// a click to the current URL was detected\n\t\t\tif (!this.currentLocation.hasHash && !target.hasHash) {\n\t\t\t\te.preventDefault()\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @return {void|boolean}\n\t */\n\tonPopstate = () => {\n\t\t// don't trigger for on-page anchors\n\t\tif (window.location.pathname === this.currentLocation.pathname && !this.isPopping) {\n\t\t\treturn false\n\t\t}\n\n\t\tif (!this.allowInterruption && (this.isTransitioning || this.isPopping)) {\n\t\t\t// overwrite history state with current page if currently navigating\n\t\t\twindow.history.pushState({}, '', this.popTarget)\n\t\t\tconsole.warn(IN_PROGRESS)\n\t\t\treturn false\n\t\t}\n\n\t\tif (!this.isPopping) {\n\t\t\tthis.popTarget = window.location.href\n\t\t}\n\n\t\tthis.isPopping = true\n\n\t\t// noinspection JSIgnoredPromiseFromCall\n\t\tthis.navigateTo(window.location.href, false, 'popstate')\n\t}\n\n\t/**\n\t * @private\n\t * @param {MouseEvent} e\n\t */\n\tonPrefetch = (e) => {\n\t\tconst target = processUrl(e.currentTarget.href)\n\n\t\tif (this.currentLocation.host !== target.host) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.preload(e.currentTarget.href, false)\n\t}\n\n\t/**\n\t * @private\n\t * @param {string} url\n\t * @param {boolean} [runFallback]\n\t * @return {Promise<{html: Document, url: string}>}\n\t */\n\tfetch(url, runFallback = true) {\n\t\t// If Taxi is currently performing a fetch for the given URL, return that instead of starting a new request\n\t\tif (this.activePromises.has(url)) {\n\t\t\treturn this.activePromises.get(url)\n\t\t}\n\n\t\tconst request = new Promise((resolve, reject) => {\n\t\t\tlet resolvedUrl\n\n\t\t\tfetch(url, {\n\t\t\t\tmode: 'same-origin',\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: { 'X-Requested-With': 'Taxi' },\n\t\t\t\tcredentials: 'same-origin'\n\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\treject('Taxi encountered a non 2xx HTTP status code')\n\n\t\t\t\t\t\tif (runFallback) {\n\t\t\t\t\t\t\twindow.location.href = url\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tresolvedUrl = response.url\n\n\t\t\t\t\treturn response.text()\n\t\t\t\t})\n\t\t\t\t.then((htmlString) => {\n\t\t\t\t\tresolve({ html: parseDom(htmlString), url: resolvedUrl })\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treject(err)\n\n\t\t\t\t\tif (runFallback) {\n\t\t\t\t\t\twindow.location.href = url\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.activePromises.delete(url)\n\t\t\t\t})\n\t\t})\n\n\t\tthis.activePromises.set(url, request)\n\n\t\treturn request\n\t}\n\n\t/**\n\t * @private\n\t * @param {string|false} transition\n\t * @return {Transition|function}\n\t */\n\tchooseTransition(transition) {\n\t\tif (transition) {\n\t\t\treturn this.transitions[transition]\n\t\t}\n\n\t\tconst routeTransition = this.router?.findMatch(this.currentLocation, this.targetLocation)\n\n\t\tif (routeTransition) {\n\t\t\treturn this.transitions[routeTransition]\n\t\t}\n\n\t\treturn this.defaultTransition\n\t}\n\n\t/**\n\t * @private\n\t * @param {Document|Node} page\n\t * @param {string} url\n\t * @return {CacheEntry}\n\t */\n\tcreateCacheEntry(page, url) {\n\t\tconst content = page.querySelector('[data-taxi-view]')\n\t\tconst Renderer = content.dataset.taxiView.length ? this.renderers[content.dataset.taxiView] : this.defaultRenderer\n\n\t\tif (!Renderer) {\n\t\t\tconsole.warn(`The Renderer \"${content.dataset.taxiView}\" was set in the data-taxi-view of the requested page, but not registered in Taxi.`)\n\t\t}\n\n\t\treturn {\n\t\t\tpage,\n\t\t\tcontent,\n\t\t\tfinalUrl: url,\n\t\t\tskipCache: content.hasAttribute('data-taxi-nocache'),\n\t\t\tscripts: this.reloadJsFilter ? Array.from(page.querySelectorAll('script')).filter(this.reloadJsFilter) : [],\n\t\t\tstyles: this.reloadCssFilter ? Array.from(page.querySelectorAll('link[rel=\"stylesheet\"]')).filter(this.reloadCssFilter) : [],\n\t\t\ttitle: page.title,\n\t\t\trenderer: new Renderer({\n\t\t\t\twrapper: this.wrapper,\n\t\t\t\ttitle: page.title,\n\t\t\t\tcontent,\n\t\t\t\tpage\n\t\t\t})\n\t\t}\n\t}\n}\n"],"names":["parser","DOMParser","processUrl","url","details","URL","window","location","origin","normalized","hash","length","replace","hasHash","pathname","host","raw","href","appendScript","node","parentNode","tagName","document","head","appendChild","duplicateScript","body","replacement","createElement","k","attributes","attr","setAttribute","nodeName","nodeValue","innerHTML","Transition","constructor","wrapper","this","leave","props","Promise","resolve","onLeave","done","enter","onEnter","Renderer","content","page","title","_contentString","outerHTML","_DOM","lastElementChild","onEnterCompleted","onLeaveCompleted","initialLoad","update","firstElementChild","createDom","remove","transition","trigger","to","then","removeOldContent","from","RouteStore","data","Map","regexCache","add","fromPattern","toPattern","has","set","RegExp","get","findMatch","currentUrl","nextUrl","potentialMatches","match","IN_PROGRESS","Core","parameters","isTransitioning","currentCacheEntry","cache","activePromises","onClick","e","metaKey","ctrlKey","target","currentTarget","currentLocation","preventDefault","navigateTo","dataset","catch","err","console","warn","onPopstate","isPopping","allowInterruption","popTarget","history","pushState","onPrefetch","preload","links","bypassCache","enablePrefetch","renderers","default","transitions","reloadJsFilter","element","undefined","taxiReload","reloadCssFilter","defaultRenderer","defaultTransition","querySelector","attachEvents","createCacheEntry","cloneNode","renderer","setDefaultRenderer","setDefaultTransition","addRoute","router","preloadAssets","fetch","async","response","_this","html","updateCache","key","delete","clearCache","reject","Error","targetLocation","TransitionClass","chooseTransition","navigationPromise","skipCache","fetched","beforeFetch","_this2","afterFetch","on","event","callback","E","off","emit","log","entry","loadScripts","scripts","loadStyles","styles","finalUrl","replaceState","cachedScripts","newScripts","currentScripts","Array","querySelectorAll","filter","i","n","replaceChild","splice","script","cachedStyles","currentStyles","forEach","el","find","link","append","delegate","runFallback","request","resolvedUrl","mode","method","headers","credentials","ok","text","htmlString","parseFromString","finally","routeTransition","_this$router","taxiView","hasAttribute"],"mappings":"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"}